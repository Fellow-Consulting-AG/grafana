{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 438,
  "links": [],
  "panels": [
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 103,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# The Celery Monitoring Dashboard\nWelcome to your central hub for monitoring our Celery tasks! This dashboard visualizes key metrics and system health, helping you quickly understand the efficiency and state of our distributed task processing. It's designed to help you spot potential issues and analyze performance trends at a glance.\n\n### Understanding the Systems: Celery & Flower üíê\nTo make the most of this dashboard, it helps to know the two core systems it monitors:\n\n#### Celery\nThink of Celery as a smart, distributed task queue. When our application needs to perform time-consuming or background jobs (like sending emails or processing data), it sends these tasks to Celery. The tasks are then stored in a queue and processed by dedicated workers.\n\n#### Flower\nFlower is the \"eyes\" of our Celery system. It's a web-based monitoring tool that gives us a detailed view of our Celery environment. Flower collects all the crucial metrics on task status and worker performance, which this Grafana dashboard then visualizes for you.\n\n## Dashboard Sections\nThe dashboard is organized into three main sections, each providing a different level of detail.\n\n### 1. KPIs (Key Metrics)\nThis section provides a quick overview of the most critical performance indicators, giving you an immediate sense of system health.\n\n√ò Task-Runtime: The average time it takes for a task to complete. A rising value can signal system overload or inefficient tasks.\n\nTask-Count (tasks per second): The number of tasks successfully completed per second, indicating the current workload.\n\n√ò Time in Queue: The average time a task waits before it is picked up by a worker. Long wait times can suggest that we need more workers.\n\nFailed Task (Rate): The rate of tasks that are failing per minute. An increase here requires immediate attention.\n\n### 2. Load Analysis\nHere, you'll find time-series graphs that help you analyze system performance over time and spot trends.\n\nTask-Status per Minute: Displays the number of successful and failed tasks over time. This is perfect for identifying peak load periods and sudden spikes in errors.\n\n√ò Runtime vs. Load: Compares the average task runtime against the current system load. This helps you see how task execution time is affected by increasing workload.\n\n### 3. Detailed Breakdowns\nThis section offers detailed, tabular data for a more in-depth analysis of individual tasks and workers.\n\n**Metrics per Task:** A table showing the average runtime and the number of successful and failed executions for each task over the last hour. Use this to pinpoint and investigate specific tasks that are underperforming.\n\n**Metrics per Worker:** A table that provides the status and load of each individual worker. You can see which workers are online, how many tasks they've processed, and how many they are currently executing. This is essential for capacity planning and troubleshooting.",
        "mode": "markdown"
      },
      "pluginVersion": "12.1.0",
      "title": "",
      "type": "text"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 100,
      "panels": [],
      "title": "KPIs (Key Metrics)",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "average run time per Task",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 9
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercent": false,
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_task_runtime_seconds_sum{namespace=\"$environment\"}[5m])) / sum(rate(flower_task_runtime_seconds_count{namespace=\"$environment\"}[5m]))",
          "format": "time_series",
          "instant": false,
          "legendFormat": "Avg. Runtime",
          "refId": "A"
        }
      ],
      "title": "√ò Task-Runtime",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "see how much load currently is ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "tps"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 9
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercent": false,
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-succeeded\"}[5m]))",
          "format": "time_series",
          "instant": false,
          "legendFormat": "Succeeded",
          "refId": "A"
        }
      ],
      "title": "Task-Count (task per second)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "how long in 'received' status",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "orange",
                "value": 10
              },
              {
                "color": "red",
                "value": 50
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 9
      },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercent": false,
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "avg(flower_task_prefetch_time_seconds{namespace=\"$environment\"})",
          "format": "time_series",
          "instant": false,
          "legendFormat": "Queue Time",
          "refId": "A"
        }
      ],
      "title": "√ò Time in Queue",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 18,
        "y": 9
      },
      "id": 10,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercent": false,
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-failed\"}[5m]))",
          "format": "time_series",
          "instant": false,
          "legendFormat": "Failed",
          "refId": "A"
        }
      ],
      "title": "Failed Task (Rate)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 17
      },
      "id": 101,
      "panels": [],
      "title": "Load Analysis",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "See how much load is",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 18
      },
      "id": 1,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "editorMode": "code",
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-succeeded\"}[5m])) * 60",
          "legendFormat": "Succeeded",
          "range": true,
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "editorMode": "code",
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-failed\"}[5m])) * 60",
          "legendFormat": "Failed",
          "range": true,
          "refId": "B"
        }
      ],
      "title": "Task-Status per Minute",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "bei hoher Last sehen k√∂nnen wielange die average time to process is",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 4,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Durchsatz"
            },
            "properties": [
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "unit",
                "value": "tps"
              },
              {
                "id": "custom.fillOpacity",
                "value": 30
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Laufzeit"
            },
            "properties": [
              {
                "id": "unit",
                "value": "s"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 27
      },
      "id": 14,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "editorMode": "code",
          "expr": "sum(rate(flower_task_runtime_seconds_sum{namespace=\"$environment\"}[5m])) / sum(rate(flower_task_runtime_seconds_count{namespace=\"$environment\"}[5m]))",
          "legendFormat": "Laufzeit",
          "range": true,
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-succeeded\"}[5m]))",
          "legendFormat": "Durchsatz",
          "refId": "B"
        }
      ],
      "title": "√ò Laufzeit vs. Last",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 36
      },
      "id": 102,
      "panels": [],
      "title": "Detailed Breakdowns",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "last hour",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "s"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Erfolgreich"
            },
            "properties": [
              {
                "id": "unit",
                "value": "tps"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Fehlgeschlagen"
            },
            "properties": [
              {
                "id": "unit",
                "value": "tps"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 12,
        "w": 12,
        "x": 0,
        "y": 37
      },
      "id": 16,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "√ò Laufzeit"
          }
        ]
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_task_runtime_seconds_sum{namespace=\"$environment\"}[1h])) by (task) / sum(rate(flower_task_runtime_seconds_count{namespace=\"$environment\"}[1h])) by (task)",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-succeeded\"}[1h])) by (task)",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "B"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(rate(flower_events_total{namespace=\"$environment\", type=\"task-failed\"}[1h])) by (task)",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "C"
        }
      ],
      "title": "Metrics per Task",
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "indexByName": {},
            "renameByName": {
              "Value #A": "√ò Laufzeit",
              "Value #B": "Erfolgreich",
              "Value #C": "Fehlgeschlagen",
              "task": "Task Name"
            }
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "description": "Last Hour",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 12,
        "w": 12,
        "x": 12,
        "y": 37
      },
      "id": 18,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(flower_worker_number_of_currently_executing_tasks{namespace=\"$environment\"}) by (worker)",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum(increase(flower_events_total{namespace=\"$environment\", type=\"task-succeeded\"}[1h])) by (worker)",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "B"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "expr": "sum by (worker) (flower_worker_online{namespace=\"$environment\"})",
          "format": "table",
          "instant": true,
          "legendFormat": "",
          "refId": "C"
        }
      ],
      "title": "Metrics per Worker",
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "indexByName": {},
            "renameByName": {
              "Value #A": "Aktive Tasks",
              "Value #B": "Verarbeitete Tasks",
              "Value #C": "Online Status",
              "worker": "Worker Name"
            }
          }
        }
      ],
      "type": "table"
    }
  ],
  "preload": false,
  "refresh": "1m",
  "schemaVersion": 41,
  "tags": [
    "flower",
    "celery"
  ],
  "templating": {
    "list": [
      {
        "current": {
          "text": "prod",
          "value": "prod"
        },
        "includeAll": false,
        "label": "Environment",
        "name": "environment",
        "options": [
          {
            "selected": false,
            "text": "sandbox",
            "value": "sandbox"
          },
          {
            "selected": true,
            "text": "prod",
            "value": "prod"
          },
          {
            "selected": false,
            "text": "demo",
            "value": "demo"
          }
        ],
        "query": "sandbox,prod,demo",
        "type": "custom"
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "Flower Celery Monitoring",
  "uid": "flower-dashboard-101",
  "version": 7
}